<!DOCTYPE html>
<script src="https://code.angularjs.org/1.6.9/angular.js"></script>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body ng-app="search">
<div class="maincontainer" ng-controller="searchController">
    <div class="col">
<form method="post" action="/search">
    <div class="card">
        <div style="padding-left: 90px;color: #fafafa">
            <div ng-if="!loading">
                <h3 style="padding-top: 17px">Jobs posted</h3>
                <br><br>
                <div style="background-color: white; width: 90%;">
                    <input style="width: 25%;" class="dropdown" style="" type="text" name="jobs" placeholder="job title"
                           ng-model="jobs"  name="jobsName" ng-change="search(jobs)" ng-model-options="{debounce: 500}"
                           autocomplete="off" required>
                    <input style="width: 25%;" ng-change="searchLocation(location)" ng-model="location"
                            placeholder="location">
                    <input style="width: 24%;" ng-change="searchSkill(skills)" ng-model="skills"
                            placeholder="skills">
                    <input style="width: 25%;" ng-change="searchCompany(company)" ng-model="company"
                            placeholder="company name">
                </div>
                <md-content>
                    <div ng-if="data.length > 0 && !dataLoading" class="poptest-main">
                        <div class="poptest-lists">
                            <ul>
                                <li class="poptest-list" ng-repeat="med in data track by $index " testid="{{ med['title'] }}">
                                    <div style="padding: 7px;
                                        margin: 8px;
                                        font-size: 15px;" class="poptest-main"><a style="color: white;text-decoration: none;" href={{med.applylink}}>{{ med['title'] }}</a></div>
                                    <div style="opacity: 0.8;padding-left: 18px;">
                                        <span ng-if="med.companyname">{{med.companyname}}</span> <span ng-if="med.experience">|| {{med.experience}}</span> <span ng-if="med.location">|| {{med.location}}</span>
                                    </div>

                                </li>
                            </ul>
                        </div>
                    </div>
                    <div ng-if="dataLoading">
                        <div style="text-align: center;">
                            <p style="font-size: 30px;margin-top: 100px;">
                                <i class="fa fa-spinner fa-pulse fa-3x fa-fw skyColor"></i>
                            <p>Loading, please wait</p>
                            </p>
                        </div>
                    </div>
                    <div ng-if="!data.length > 0 && !notFound"  style="padding: 21px;margin: 16px;font-size: 19px;" class="poptest-main">Amazing Opportunities are waiting for you.
                        Search and find the careers which is matching your skills</div>
                    <div ng-if="notFound && data.length < 1" style="padding: 21px;margin: 16px;font-size: 19px;" class="poptest-main">jobs not found</div>
                </md-content>
            </div>
            <div ng-if="loading">
                <div style="text-align: center;padding-top: 200px">
                    <p style="font-size: 30px;margin-top: 100px;">
                        <i class="fa fa-spinner fa-pulse fa-3x fa-fw skyColor"></i>
                    <p>Loading, please wait</p>
                    </p>
                </div>
            </div>
        </div>
    </div>
</form>
    </div>
</div>
</body>
</html>
<style>
    html {  
            height: 100%;
        }

        body {
            font-family: 'Roboto', sans-serif;
            font-weight: 300;
            min-height: 100%;
            background: #fafafa

        }
    .maincontainer{
        background: #a72ca3c7
    }
    .card {
            background: #a72ca3c7;
            width: 90%;
            height: 90%;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .2), 0 1px 1px 0 rgba(0, 0, 0, .14), 0 2px 1px -1px rgba(0, 0, 0, .12);
            position: fixed;
            margin: auto;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            border-radius: 3px;
        }
        .poptest-main{
        padding: 0px;
        margin: 1px 116px;
        min-width: 40px;
        overflow: auto;
        z-index: 1;
        cursor: pointer;
        } 
    
        poptest-list{
           padding: 2px 2px 2px 2px;
        }

    .dropbtn {
        background-color: #3498DB;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
        cursor: pointer;
    }

    .dropbtn:hover, .dropbtn:focus {
        background-color: #2980B9;
    }

    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        overflow: auto;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
    }

    .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }
             
        
</style>
<script>
    angular.module("search", []).controller("searchController", function($scope,$http) {
        $scope.loading=true;
        $scope.search = function (query) {
            $scope.dataLoading=true;
            if (query) {
                $http.get('/data', {params: {query: query}}).then(
                    function successCallback(res) {
                        $scope.data = res.data;
                        $scope.loading=false;
                        $scope.dataLoading=false;
                        $scope.notFound = false;
                    });
            } else {
                $scope.notFound = true;
                getPopularjobs();
            }
        };
        var getPopularjobs = function () {
            $http.get('/data', {params: {}}).then(function successCallback(result) {
                console.log("res", result)
                $scope.data = result.data;
                $scope.loading=false;
                $scope.dataLoading=false;
                $scope.jobs=null;
                $scope.location=null;
                $scope.skills=null;
                $scope.company=null;

            }, function errorCallback(response) {
            });
        };
        getPopularjobs();


        $scope.searchLocation = function(loc)
        {
            $scope.dataLoading=true;
            if(loc)
            {
                $http.get('/location', {params: {query: loc}}).then(
                    function successCallback(res) {
                        $scope.data = res.data;
                        $scope.dataLoading=false;
                        $scope.notFound = false;
                    });
            } else {
                $scope.notFound = true;
                getPopularjobs();
            }

        };

        $scope.searchSkill = function(skill)
        {
            $scope.dataLoading=true;
            if(skill)
            {
                $http.get('/skills', {params: {query: skill}}).then(
                    function successCallback(res) {
                        $scope.data = res.data;
                        $scope.dataLoading=false;
                        $scope.notFound = false;
                    });
            } else {
                $scope.notFound = true;
                getPopularjobs();
            }

        };

        $scope.searchCompany = function(company)
        {
            $scope.dataLoading=true;
            if(company)
            {
                $http.get('/skills', {params: {query: company}}).then(
                    function successCallback(res) {
                        $scope.data = res.data;
                        $scope.dataLoading=false;
                        $scope.notFound = false;
                    });
            } else {
                $scope.notFound = true;
                getPopularjobs();
            }

        };


    });

</script>